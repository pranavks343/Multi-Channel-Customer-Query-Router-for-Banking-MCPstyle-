<!DOCTYPE html>
<html>
<head>
    <title>Simple Tickets Test</title>
    <style>
        body { font-family: Arial; max-width: 900px; margin: 40px auto; padding: 20px; }
        .ticket { border: 2px solid #ff1493; margin: 10px 0; padding: 15px; background: #fff5f7; border-radius: 8px; }
        .ticket-id { font-weight: bold; color: #ff1493; font-size: 1.1em; }
        button { padding: 12px 24px; background: #ff1493; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 5px; }
        button:hover { background: #ff69b4; }
        #status { padding: 15px; border-radius: 8px; margin: 15px 0; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>üéüÔ∏è Simple Tickets Test Page</h1>
    <p>This is a minimal test page to verify tickets are loading from the API.</p>
    
    <div>
        <button onclick="testAPI()">üîÑ Test API</button>
        <button onclick="location.href='/'">‚¨ÖÔ∏è Back to Main App</button>
    </div>

    <div id="status"></div>
    <div id="results"></div>

    <script>
        async function testAPI() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            // Step 1: Show loading
            statusDiv.className = 'info';
            statusDiv.innerHTML = '‚è≥ <strong>Step 1:</strong> Fetching tickets from /api/tickets...';
            resultsDiv.innerHTML = '';
            
            try {
                // Step 2: Fetch
                const startTime = Date.now();
                const response = await fetch('/api/tickets');
                const fetchTime = Date.now() - startTime;
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                // Step 3: Parse JSON
                const data = await response.json();
                const parseTime = Date.now() - startTime;
                
                console.log('API Response:', data);
                
                // Step 4: Display results
                if (data.success && data.tickets) {
                    statusDiv.className = 'success';
                    statusDiv.innerHTML = `
                        ‚úÖ <strong>SUCCESS!</strong><br>
                        - Fetch time: ${fetchTime}ms<br>
                        - Parse time: ${parseTime}ms<br>
                        - Tickets received: ${data.tickets.length}<br>
                        - API response size: ${JSON.stringify(data).length} bytes
                    `;
                    
                    if (data.tickets.length === 0) {
                        resultsDiv.innerHTML = '<p><strong>No tickets in database</strong></p>';
                    } else {
                        resultsDiv.innerHTML = '<h2>Tickets (Most Recent First):</h2>' +
                            data.tickets.map((ticket, index) => `
                                <div class="ticket">
                                    <div class="ticket-id">#${index + 1}: ${ticket.ticket_id}</div>
                                    <div><strong>Channel:</strong> ${ticket.channel} | 
                                         <strong>Urgency:</strong> ${ticket.urgency} | 
                                         <strong>Team:</strong> ${ticket.assigned_team}</div>
                                    <div><strong>Message:</strong> ${ticket.message}</div>
                                    <div style="font-size: 0.9em; color: #666; margin-top: 8px;">
                                        <strong>Created:</strong> ${ticket.created_at}
                                    </div>
                                </div>
                            `).join('');
                    }
                } else {
                    statusDiv.className = 'error';
                    statusDiv.innerHTML = `
                        ‚ùå <strong>API Error</strong><br>
                        ${data.error || 'Unknown error'}<br>
                        Response: ${JSON.stringify(data)}
                    `;
                }
            } catch (error) {
                statusDiv.className = 'error';
                statusDiv.innerHTML = `
                    ‚ùå <strong>JavaScript Error</strong><br>
                    ${error.message}<br>
                    <br>
                    <strong>Possible causes:</strong><br>
                    - Network connection issue<br>
                    - API endpoint not responding<br>
                    - CORS policy blocking request
                `;
                console.error('Error:', error);
            }
        }
        
        // Auto-run test on page load
        window.onload = function() {
            console.log('Page loaded, testing API...');
            testAPI();
        };
    </script>
</body>
</html>

